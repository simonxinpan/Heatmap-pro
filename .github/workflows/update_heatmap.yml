name: Update Stock Market Data

on:
  schedule:
    # æ¯ä¸ªå·¥ä½œæ—¥çš„ç¾è‚¡å¼€ç›˜å‰å’Œæ”¶ç›˜åå„è¿è¡Œä¸€æ¬¡
    # ç¾ä¸œæ—¶é—´ 9:00 AM (åŒ—äº¬æ—¶é—´ 22:00) å’Œ 4:30 PM (åŒ—äº¬æ—¶é—´ 5:30)
    - cron: '0 14 * * 1-5'  # UTC 14:00 = ç¾ä¸œ 9:00 AM (å¤ä»¤æ—¶)
    - cron: '30 21 * * 1-5' # UTC 21:30 = ç¾ä¸œ 4:30 PM (å¤ä»¤æ—¶)
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  update-stocks:
    runs-on: ubuntu-latest
    
    steps:
    - name: Update Stock Data
      run: |
        echo "ğŸš€ Starting stock data update..."
        
        # è°ƒç”¨æˆ‘ä»¬çš„æ›´æ–°API
        response=$(curl -s -w "\n%{http_code}" \
          -X POST \
          -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
          -H "Content-Type: application/json" \
          "https://heatmap-75urkdehl-simon-pans-projects.vercel.app/api/update-stocks")
        
        # åˆ†ç¦»å“åº”ä½“å’ŒçŠ¶æ€ç 
        http_code=$(echo "$response" | tail -n1)
        response_body=$(echo "$response" | head -n -1)
        
        echo "ğŸ“Š API Response: $response_body"
        echo "ğŸ”¢ HTTP Status: $http_code"
        
        # æ£€æŸ¥æ˜¯å¦æˆåŠŸ
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… Stock data update completed successfully!"
        else
          echo "âŒ Stock data update failed with status code: $http_code"
          echo "Response: $response_body"
          exit 1
        fi
        
        echo "ğŸ¯ Heatmap data is now up-to-date!"